From 447a39cc89460628828750f69a4883fa392f6c12 Mon Sep 17 00:00:00 2001
From: David Shea <dshea@redhat.com>
Date: Fri, 25 Apr 2014 14:47:59 -0400
Subject: [PATCH 03/19] Add io_flags parameter to insmod

This becomes relevant with the softdeps changes
---
 modprobe.c | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/modprobe.c b/modprobe.c
index 27c9bb2..4b0ba98 100644
--- a/modprobe.c
+++ b/modprobe.c
@@ -617,7 +617,8 @@ static int insmod(struct list_head *list,
 		   int ignore_inuse,
 		   int strip_vermagic,
 		   int strip_modversion,
-		   const char *cmdline_opts)
+		   const char *cmdline_opts,
+                   int io_flags)
 {
 	int ret, fd;
 	struct elf_file *module;
@@ -632,7 +633,7 @@ static int insmod(struct list_head *list,
 	if (!list_empty(list)) {
 		if ((rc = insmod(list, NOFAIL(strdup("")), NULL, 0, warn,
 		       dry_run, options, commands, 0, ignore_inuse,
-		       strip_vermagic, strip_modversion, "")) != 0) {
+		       strip_vermagic, strip_modversion, "", io_flags)) != 0) {
 			error("Error inserting %s (%s): %s\n",
 				mod->modname, mod->filename,
 				insert_moderror(errno));
@@ -1313,7 +1314,7 @@ static int handle_module(const char *modname,
 		insmod(todo_list, NOFAIL(strdup(options)), newname,
 		       first_time, error, dry_run, modoptions,
 		       commands, ignore_commands, ignore_inuse, strip_vermagic,
-		       strip_modversion, cmdline_opts);
+		       strip_modversion, cmdline_opts, io_flags);
 
 	return 0;
 }
-- 
1.9.0

